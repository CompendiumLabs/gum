<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">

<head>

<meta name="viewport" content="width=device-width, initial-scale=1">

<title>gum.js</title>

<style>

html, body {
    height: 98%;
}

#main {
    width: 80%;
    height: 85%;
    padding-top: 3%;
    display: flex;
    margin: auto;
}

#left {
    width: 40%;
}

#right {
    width: 60%;
}

#left, #right {
    padding: 10px;
    display: flex;
}

#right {
    flex-direction: column;
}

#code, #conv {
    width: 100%;
    height: 99.5%;
    outline: 0;
    margin: 0;
    padding: 0;
    resize: none;
}

#disp {
    height: 50%;
}

#conv {
    height: 50%;
}

</style>

</head>

<body>

<div id="main">

<div id="left">

<textarea id="code">
let n = 12;
let r = new Rect();
let g = new Group(
    range(n)
    .map(i => (180/n)*(i-n/2))
    .map(t => new Ray(t))
);
new Group([r, g])
</textarea>

</div>

<div id="right">

<div id="disp"></div>

<textarea id="conv" readonly></textarea>

</div>

</div>

<script type="module">

import { range, Context, Element, Container, Group, SVG, HStack, VStack, Ray, Rect } from './gum.mjs'

let prec = 2;

function height(el) {
    return parseFloat(getComputedStyle(el, null).height.replace("px", ""));
}

function renderGum(e, size) {
    if (e instanceof SVG) {
        let rect = [0, 0, size, size];
        let ctx = Context(rect, prec);
        return e.svg(ctx);
    } else if (e instanceof Element) {
        return new SVG([e], size).svg(prec);
    } else {
        return e;
    }
}

let code = document.querySelector('#code');
let conv = document.querySelector('#conv');
let disp = document.querySelector('#disp');

function renderCode() {
    let c = code.value;
    let e = eval(c);
    let size = 0.95*height(disp);
    let s = renderGum(e, size);
    conv.value = s;
    disp.innerHTML = s;
}

renderCode();

code.addEventListener('keypress', function(event) {
    let key = event.key.toLowerCase();
    let ctrl = event.ctrlKey;

    if (ctrl && key == 'enter') {
        renderCode();
    }
});

</script>

</body>

</html>
