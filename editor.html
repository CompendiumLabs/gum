<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">

<head>

<meta name="viewport" content="width=device-width, initial-scale=1">

<title>gum.js</title>

<style>

textarea {
    margin: 0;
    border: 0;
    outline: none;
    resize: none;
    padding: 10px;
    scrollbar-width: none;
}

svg {
    fill: none;
    stroke: black;
    background-color: white;
}

body {
    margin: 0;
}

#main {
    position: fixed;
    display: flex;
    height: 100%;
    width: 100%;
}

#left, #right {
    display: flex;
    justify-content: space-between;
    position: relative;
}

#left {
    flex-direction: column;
    width: 50%;
    border-right: 1px solid gray;
}

#right {
    justify-content: center;
    align-items: center;
    width: 50%;
    background-color: #EEE;
}

#code {
    height: 50%;
}

#conv {
    height: 50%;
    border-top: 1px solid gray;
}

#disp {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 80%;
    height: 100%;
}

#disp svg {
    max-height: 80%;
}

#stat {
    position: absolute;
    top: 0;
    right: 0;
    width: 15px;
    height: 15px;
    border-radius: 15px;
    margin: 5px;

}

#stat.good {
    background-color: #1e88e5;
}

#stat.bad {
    background-color: #ff0d57;
}

</style>

</head>

<body>

<div id="main">

<div id="left">

<div id="stat"></div>

<textarea id="code">
let n = 12;
let r = Rect();
let s = Group(
    range(-90, 90, 180/n)
    .map(t => Ray(t))
);
let hs = HStack([s, s]);
let vs = VStack([hs, hs]);
let gg = Group([vs, r]);
return gg;</textarea>

<textarea id="conv" readonly></textarea>

</div>

<div id="right">

<div id="disp"></div>

</div>

</div>

<script type="module">

import { Gum, SVG, Element } from './gum.js'

// svg presets
let prec = 2;
let size = 500;

// gum.js interface mapper
let gums = Gum.map(g => g.name);
let mako = Gum.map(g => function(...args) { return new g(...args); });

// html elements
let code = document.querySelector('#code');
let conv = document.querySelector('#conv');
let disp = document.querySelector('#disp');
let stat = document.querySelector('#stat');

// canned error messages
let err_nodata = 'No data. Does your final line return an element?';

// wrap in SVG if needed
function renderGum(elem, size) {
    if (elem instanceof Element) {
        elem = (elem instanceof SVG) ? elem : new SVG([elem]);
        return elem.svg({size: size, prec: prec});
    } else {
        return elem;
    }
}

function renderCode() {
    let elem;
    try {
        let expr = new Function(gums, code.value);
        elem = expr(...mako);
    } catch (e) {
        conv.value = `error, line ${e.lineNumber}: ${e.message}`;
        stat.classList = ['bad'];
        return;
    }

    if (elem == null) {
        conv.value = err_nodata;
        stat.classList = [];
    } else {
        let svg = renderGum(elem, size);
        conv.value = svg;
        disp.innerHTML = svg;
        stat.classList = ['good'];
    }
}

// auto update
code.addEventListener('input', renderCode);

// initialize
renderCode();

</script>

</body>

</html>
